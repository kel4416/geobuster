<html>
	<head>
		<meta charset="utf-8">
		<title>GeoBuster</title>

		<script src="js/jquery-1.9.1.js"></script>
		<script src="js/jquery-ui-1.10.2.custom.js"></script>
		<script src="js/jquery.tipsy.js"></script>
		<script src="js/jquery.selectbox-0.2.min.js"></script>
		<script src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>

		<script src="js/d3.v3.js"></script>
		<script src="js/topojson.js"></script>

		<link href="css/ui-darkness/jquery-ui-1.10.2.custom.css" rel="stylesheet">
		<link href="css/style.css" media="screen" rel="stylesheet" type="text/css" />
		<link href="css/tipsy.css" media="screen" rel="stylesheet" type="text/css"/>
		<link href="css/pop-table.css" media="screen" rel="stylesheet" type="text/css"/>
		<link href="css/jquery.selectbox.css" media="screen" rel="stylesheet" type="text/css"/>
		<script>
			$(document).ready(function() {
				$('svg title').parent().tipsy({
					gravity : $.fn.tipsy.autoNS,
					interactive : true,
					html : true,
					delayOut : 5,
					title : function() {
						var d = this.__data__;
						return '<a href="http://www.volcano.si.edu/world/list.cfm?searchtext=' + d.properties.NAME + '">' + d.properties.NAME + '</a>' + '<p>Location: ' + d.properties.LOCATION + '</p>' + '<p>Status: ' + d.properties.STATUS + '</p>' + '<p>Elevation: ' + d.properties.ELEV + '</p>' + '<p>Type: ' + d.properties.TYPE + '</p>' + '<p>Year Erupted: ' + d.properties.YEAR + '</p>';
					}
				});

				$('#dynamic-table').dataTable({
					"bJQueryUI" : true,
					"iDisplayLength" : 5,
					"bPaginate" : true,
					"bLengthChange" : false,
					"sPaginationType" : "full_numbers"
				});
				$("#selectType").selectbox();
				$("#selectLocation").selectbox();
				$("#selectStatus").selectbox();
				
				$("#submitButton").button();
				$("#submitButton").click(function() {
					g.selectAll(".volcano").attr("visibility", function(d) {
						var typeSelected = $("#selectType").val();
						var locationSelected = $("#selectType").val();
						var statusSelected = $("#selectType").val();
						return "visible";	
					});
				});
				
				$("#tectonicSwitch").button();
				$("#tectonicSwitch").click(function() {
					g.selectAll(".tectonic").attr("visibility",function(d){
						
						if ($("#tectonicSwitch").button("option", "label") === "Hide Tectonic"){
							$("#tectonicSwitch").button("option", "label", "Show Tectonic");
							return "hidden";
						}else{
							$("#tectonicSwitch").button("option", "label", "Hide Tectonic");
							return "visible";
						}
						
					});
				});
			});
		</script>
	</head>
	<body>

		<table align="center">
			<tr height="330px">
				<td align="center" bgcolor="black" style="padding-right: 20px;font-size:10px"><div id="map"></div>
				<p style="color:white;">
					*hovering over volcano points will show volcano by types
				</p><script src="js/map.js"></script></td>
				<td align="left" valign="top" style="color: white;background-color:black"><img src="img/GeoLogo.png" width="50%" alt="logo"/>
				<br/>
				<br/>
				<div class="header" align="center" title="The type of volcano that can be sorted">
					Search
				</div>
				<br/>
				<table style="background-color: black;color: white;text-align: center">
					<tr>
						<td align="center"> Volcano Type: <div id="volcano_type" align="center"></div></td>
						<td align="center"> Volcano location: <div id="volcano_location" align="center"></div></td>
						<td align="center"> Volcano Status: <div id="volcano_status" align="center"></div></td>
					</tr>
				</table>
				<script>
					function change(d) {
						//alert(this.value);
						var selectedValue = this.value;
						g.selectAll(".volcano").attr("visibility", function(d) {
							if (selectedValue === "Select All") {
								return "visible";
							}
							return d.properties.TYPE === selectedValue ? "visible" : "hidden";
						});
					}


					d3.json("data/volcano.geojson", function(collection) {
						var unique_volcano_type = new Array();
						var unique_volcano_location = new Array();
						var unique_volcano_status = new Array();
						unique_volcano_type.push("Select All");
						unique_volcano_location.push("Select All");
						unique_volcano_status.push("Select All");
						for ( i = 0; i < collection.features.length; i++) {

							if (unique_volcano_type.indexOf(collection.features[i].properties.TYPE) > -1) {
								//alert(collection.features[i].properties.TYPE);
							} else {
								var item = collection.features[i].properties.TYPE;
								unique_volcano_type.push(item);
							}

							if (unique_volcano_location.indexOf(collection.features[i].properties.LOCATION) > -1) {
								//alert(collection.features[i].properties.TYPE);
							} else {
								var item = collection.features[i].properties.LOCATION;
								unique_volcano_location.push(item);
							}

							if (unique_volcano_status.indexOf(collection.features[i].properties.STATUS) > -1) {
								//alert(collection.features[i].properties.TYPE);
							} else {
								var item = collection.features[i].properties.STATUS;
								unique_volcano_status.push(item);
							}
						}

						d3.select("#volcano_type").append("select").attr("id", "selectType")./*on("change", change).*/selectAll("option").data(unique_volcano_type).enter().append("option").attr("value", function(d) {
							return d;
						}).text(function(d) {
							return d;
						});

						d3.select("#volcano_location").append("select").attr("id", "selectLocation")./*on("change", change).*/selectAll("option").data(unique_volcano_location).enter().append("option").attr("value", function(d) {
							return d;
						}).text(function(d) {
							return d;
						});

						d3.select("#volcano_status").append("select").attr("id", "selectStatus")./*on("change", change).*/selectAll("option").data(unique_volcano_status).enter().append("option").attr("value", function(d) {
							return d;
						}).text(function(d) {
							return d;
						});

					});

				</script>
				<br/>
				<br/>
				Eruption Year Range:
				<br/>
				<br/>
				<!-- <button id="slider-switch">
				Activate Slider
				</button>
				<script>
				$("#slider-switch").button();
				$("#slider-switch").click(function() {
				if ($("#slider-switch").button("option", "label") === "Activate Slider") {
				$("#scale").slider("enable");
				$("#slider-switch").button("option", "label", "Deactivate Slider");

				g.selectAll('.volcano').style("display", "none");
				var slider_current_values = $("#scale").slider("values");
				var years = [-9000, -8000, -7000, -6000, -5000, -4000, -3000, -2000, -1000, 1000, 2000];

				for ( i = years[slider_current_values[0]]; i < years[slider_current_values[1]]; i++) {
				$tempvalue = '' + i;
				$tempvalueclass = '._' + $tempvalue;

				g.selectAll($tempvalueclass).style("display", "block");
				}
				} else {
				$("#scale").slider("disable");
				$("#slider-switch").button("option", "label", "Activate Slider");
				g.selectAll('.volcano').style("display", "block");
				}
				});
				</script> --><div id="scale" class="slider" style="margin-left: 10%"></div>
				<p id="slidertext" align="center">
					Eruptions during -6000 to -2000
				</p>
				<script>
					$("#scale").slider({
						range : true,
						min : 0,
						max : 10,
						values : [3, 7], //default slider value
						step : 1, // step is the allow increments the slider can move. 1 = 1000 years
						// slide : function(event, ui) {
						// var years = [-9000, -8000, -7000, -6000, -5000, -4000, -3000, -2000, -1000, 1000, 2000];
						// var slider1Value = ui.values[0];
						// var slider2Value = ui.values[1];
						// // if (slider1Value == 0 && slider2Value == 0) {
						// // g.selectAll('.volcano').style("display", "block");
						// //
						// // d3.select("#slidertext").text("All eruptions During -8500 - 2012");
						// // } else {
						//
						// g.selectAll('.volcano').style("display", "none");
						// for ( i = years[slider1Value]; i < years[slider2Value]; i++) {
						// $tempvalue = '' + i;
						// $tempvalueclass = '._' + $tempvalue;
						//
						// g.selectAll($tempvalueclass).style("display", "block");
						//
						// }
						// d3.select("#slidertext").text('Eruptions during ' + years[slider1Value] + ' to ' + years[slider2Value]);
						// }
						// }
					});
				</script>
				<button id="submitButton">Get me my volcanos!</button>
				<br/>
				<br/>
				<div class="header" align="center">
					Tectonic Switch
				</div>
				<br/>
				<button id="tectonicSwitch">Hide Tectonic</button>
				<br/>
				<br/></td>
				
			</tr>
			<tr>
				<td id="supplementary_graph" style="font: 10px sans-serif;color:white;background-color:black" align="center">
				<div class="header">
					Frequency of Volcano Eruptions
				</div><script src="js/bar.js"></script></td>
				<td style="font: 12px sans-serif;background-color:black">
				<div class="header">
					Volcano Details
				</div>
				<p style="color:white">
					*click on the red dots to add volcano data
				</p>
				<table id="dynamic-table" width="100%" style="font-size:13px">
					<thead>
						<tr>
							<th align="left" width="20%">Name</th>
							<th align="left">Location</th>
							<th align="left">Status</th>
							<th align="left">Elevation
							<br/>
							(m)</th>
							<th align="left" width="20%">Type</th>
							<th align="left">Year
							<br/>
							Erupted</th>

						</tr>
					</thead>
					<tbody></tbody>
				</table>
				<br/>
				<button id="clear-table">
					Clear Table
				</button>
				<script>
					$("#clear-table").button();
					$("#clear-table").click(function() {
						$('#dynamic-table').dataTable().fnClearTable();
					});
				</script></td>
			</tr>
		</table>
	</body>
</html>
