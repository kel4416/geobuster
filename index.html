<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>GeoBuster</title>

		<script src="js/jquery-1.9.1.js"></script>
		<script src="js/jquery-ui-1.10.2.custom.js"></script>
		<script src="js/jquery.tipsy.js"></script>

		<script src="js/d3.v3.js"></script>
		<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
		<script src="http://d3js.org/topojson.v0.min.js"></script>

		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>

		<link href="css/ui-darkness/jquery-ui-1.10.2.custom.css" rel="stylesheet">
		<link href="css/style.css" media="screen" rel="stylesheet" type="text/css" />
		<link href="css/tipsy.css" media="screen" rel="stylesheet" type="text/css"/>
	</head>
	<body>
		<table align="center">
			<tr>
				<td align="center" width="80%"><div id="map"></div><script src="js/map.js"></script></td>
				<td align="left" valign="top" style="color: white;background-color:#302217"><img src="img/GeoLogo.png" width="100%" alt="logo"/>
				<br/>
				<br/>
				<div class="header" align="center">
					Volcano Type
				</div>
				<br/>
				<div id="volcano_type" align="center"></div>
				<script>
					$(document).ready(function() {
						$('svg title').parent().tipsy({
							gravity : 'w'
						});
					});

					function change(d) {
						//alert(this.value);
						var selectedValue = this.value;
						g.selectAll(".volcano").attr("visibility", function(d) {
							if(selectedValue === "Select All"){
								return "visible";
							}
							return d.properties.TYPE === selectedValue ? "visible" : "hidden";
						});
					}


					d3.json("data/volcano.geojson", function(collection) {
						var unique_volcano_type = new Array();
						unique_volcano_type.push("Select All");
						for ( i = 0; i < collection.features.length; i++) {

							if (unique_volcano_type.indexOf(collection.features[i].properties.TYPE) > -1) {
								//alert(collection.features[i].properties.TYPE);
							} else {
								var item = collection.features[i].properties.TYPE;
								unique_volcano_type.push(item);
							}
						}

						d3.select("#volcano_type").append("select").on("change", change).selectAll("option").data(unique_volcano_type).enter().append("option").attr("value", function(d) {
							return d;
						}).text(function(d) {
							return d;
						});
					});

				</script>
				<br/>
				<div class="header" align="center">
					Eruption Frequency
				</div>
				<br/>
				<button id="slider-switch" style="margin-left:20px">Activate Slider</button>
				<script>
					$("#slider-switch").button();
					$("#slider-switch").click(function(){
						if ( $( "#slider-switch" ).button( "option", "label" ) === "Activate Slider"){
							$("#scale").slider("enable");
							$("#slider-switch").button( "option", "label", "Deactivate Slider" );
							
							g.selectAll('.volcano').style("display", "none");
							var slider_current_values = $( "#scale").slider( "values" );
							var years = [-9000, -8000, -7000, -6000, -5000, -4000, -3000, -2000, -1000, 1000, 2000];
							
							for(i = years[slider_current_values[0]] ; i < years[slider_current_values[1]] ; i++){
									$tempvalue = '' + i;
									$tempvalueclass = '._' + $tempvalue;
	
									g.selectAll($tempvalueclass).style("display", "block");
							}
						}else{
							$("#scale").slider("disable");
							$("#slider-switch").button( "option", "label", "Activate Slider" );
							g.selectAll('.volcano').style("display", "block");
						}
					});
				</script>
				<br/>
				<br/>
				<div id="scale" class="slider"></div>
				<p id="slidertext" style="margin-left:10%">
					All eruptions During -6000 to -2000
				</p>
				<script>
					$("#scale").slider({
						range: true,
						min : 0,
						max : 10,
						values : [3,7], //default slider value
						step : 1, // step is the allow increments the slider can move. 1 = 1000 years
						slide : function(event, ui) {
							var years = [-9000, -8000, -7000, -6000, -5000, -4000, -3000, -2000, -1000, 1000, 2000];
							var slider1Value = ui.values[0];
							var slider2Value = ui.values[1];
							// if (slider1Value == 0 && slider2Value == 0) {
								// g.selectAll('.volcano').style("display", "block");
// 
								// d3.select("#slidertext").text("All eruptions During -8500 - 2012");
							// } else {

							g.selectAll('.volcano').style("display", "none");
							for(i = years[slider1Value] ; i < years[slider2Value] ; i++){
								$tempvalue = '' + i;
								$tempvalueclass = '._' + $tempvalue;

								g.selectAll($tempvalueclass).style("display", "block");

								
							}
							d3.select("#slidertext").text('All eruptions During ' + years[slider1Value] + ' to ' + years[slider2Value]);
							//}
						}
					});
					
					$("#scale").slider("disable");
				</script></td>
			</tr>
			<tr>
				<td> Supplementary Graph </td>
				<td> Statistics DashBoard </td>
			</tr>
		</table>
	</body>
</html>
