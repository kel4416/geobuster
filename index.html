<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>GeoBuster</title>

		<script src="js/jquery-1.9.1.js"></script>
		<script src="js/jquery-ui-1.10.2.custom.js"></script>
		<script src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>
		<script src="js/jquery.tipsy.js"></script>

		<script src="js/d3.v3.js"></script>
		<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
		<script src="http://d3js.org/topojson.v0.min.js"></script>

		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>

		<link href="css/ui-darkness/jquery-ui-1.10.2.custom.css" rel="stylesheet">
		<link href="css/style.css" media="screen" rel="stylesheet" type="text/css" />
		<link href="css/tipsy.css" media="screen" rel="stylesheet" type="text/css"/>
		<link href="css/pop-table.css" media="screen" rel="stylesheet" type="text/css"/>
		<script>
			$(document).ready(function() {
				$("#tabs").tabs({
					heightStyle : "fill"
				});

				$('#dynamic-table').dataTable({
					"bJQueryUI" : true,
					"iDisplayLength": 5,
                    "bPaginate": true,
                    "bLengthChange": false,
                    "sPaginationType": "full_numbers"
				});

			});
		</script>
	</head>
	<body>
		<table align="center">
			<tr>
				<td align="center" width="80%"><div id="map"></div><script src="js/map.js"></script></td>
				<td align="left" valign="top" style="color: white;background-color:#302217"><img src="img/GeoLogo.png" width="100%" alt="logo"/>
				<br/>
				<br/>
				<div id="tabs">
					<ul>
						<li>
							<a href="#tabs-1">World</a>
						</li>
						<li>
							<a href="#tabs-2">Washingtion</a>
						</li>
					</ul>
					<div id=tabs-1>
						<div class="header" align="center">
							Volcano Type
						</div>
						<br/>
						<div id="volcano_type" align="center"></div>
						<script>
							$(document).ready(function() {
								$('svg title').parent().tipsy({
									gravity : 'w'
								});
							});
							function change(d) {
								//alert(this.value);
								var selectedValue = this.value;
								g.selectAll(".volcano").attr("visibility", function(d) {
									if (selectedValue === "Select All") {
										return "visible";
									}
									return d.properties.TYPE === selectedValue ? "visible" : "hidden";
								});
							}


							d3.json("data/volcano.geojson", function(collection) {
								var unique_volcano_type = new Array();
								unique_volcano_type.push("Select All");
								for ( i = 0; i < collection.features.length; i++) {

									if (unique_volcano_type.indexOf(collection.features[i].properties.TYPE) > -1) {
										//alert(collection.features[i].properties.TYPE);
									} else {
										var item = collection.features[i].properties.TYPE;
										unique_volcano_type.push(item);
									}
								}

								d3.select("#volcano_type").append("select").on("change", change).selectAll("option").data(unique_volcano_type).enter().append("option").attr("value", function(d) {
									return d;
								}).text(function(d) {
									return d;
								});
							});

						</script>
						<br/>
						<div class="header" align="center">
							Eruption Frequency
						</div>
						<br/>
						<button id="slider-switch">
							Activate Slider
						</button>
						<script>
							$("#slider-switch").button();
							$("#slider-switch").click(function() {
								if ($("#slider-switch").button("option", "label") === "Activate Slider") {
									$("#scale").slider("enable");
									$("#slider-switch").button("option", "label", "Deactivate Slider");

									g.selectAll('.volcano').style("display", "none");
									var slider_current_values = $("#scale").slider("values");
									var years = [-9000, -8000, -7000, -6000, -5000, -4000, -3000, -2000, -1000, 1000, 2000];

									for ( i = years[slider_current_values[0]]; i < years[slider_current_values[1]]; i++) {
										$tempvalue = '' + i;
										$tempvalueclass = '._' + $tempvalue;

										g.selectAll($tempvalueclass).style("display", "block");
									}
								} else {
									$("#scale").slider("disable");
									$("#slider-switch").button("option", "label", "Activate Slider");
									g.selectAll('.volcano').style("display", "block");
								}
							});
						</script>
						<br/>
						<br/>
						<div id="scale" class="slider"></div>
						<p id="slidertext" style="margin-left:10%">
							Eruptions during -6000 to -2000
						</p>
						<script>
							$("#scale").slider({
								range : true,
								min : 0,
								max : 10,
								values : [3, 7], //default slider value
								step : 1, // step is the allow increments the slider can move. 1 = 1000 years
								slide : function(event, ui) {
									var years = [-9000, -8000, -7000, -6000, -5000, -4000, -3000, -2000, -1000, 1000, 2000];
									var slider1Value = ui.values[0];
									var slider2Value = ui.values[1];
									// if (slider1Value == 0 && slider2Value == 0) {
									// g.selectAll('.volcano').style("display", "block");
									//
									// d3.select("#slidertext").text("All eruptions During -8500 - 2012");
									// } else {

									g.selectAll('.volcano').style("display", "none");
									for ( i = years[slider1Value]; i < years[slider2Value]; i++) {
										$tempvalue = '' + i;
										$tempvalueclass = '._' + $tempvalue;

										g.selectAll($tempvalueclass).style("display", "block");

									}
									d3.select("#slidertext").text('Eruptions during ' + years[slider1Value] + ' to ' + years[slider2Value]);
									//}
								}
							});

							$("#scale").slider("disable");
						</script>
					</div>
					<div id="tabs-2">
						functions for washington
					</div>
				</div></td>
			</tr>
			<tr>
				<td id="supplementary_graph" style="font: 10px sans-serif;color:white;background-color:#302217" width="70%" align="center">
				<div class="header">
					Population Demographic
				</div>
				<script>
					var margin = {
						top : 20,
						right : 20,
						bottom : 30,
						left : 40
					}, width = 960 - margin.left - margin.right, height = 300 - margin.top - margin.bottom;

					var x = d3.scale.ordinal().rangeRoundBands([0, width], .1);

					var y = d3.scale.linear().rangeRound([height, 0]);

					var color = d3.scale.ordinal().range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

					var xAxis = d3.svg.axis().scale(x).orient("bottom");

					var yAxis = d3.svg.axis().scale(y).orient("left").tickFormat(d3.format(".2s"));

					var svg = d3.select("#supplementary_graph").append("svg").attr("width", width + margin.left + margin.right).attr("height", height + margin.top + margin.bottom).append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

					d3.csv("data/us-popdata.csv", function(error, data) {
						color.domain(d3.keys(data[0]).filter(function(key) {
							return key !== "State";
						}));

						data.forEach(function(d) {
							var y0 = 0;
							d.ages = color.domain().map(function(name) {
								return {
									name : name,
									y0 : y0,
									y1 : y0 += +d[name]
								};
							});
							d.total = d.ages[d.ages.length - 1].y1;
						});

						data.sort(function(a, b) {
							return b.total - a.total;
						});

						x.domain(data.map(function(d) {
							return d.State;
						}));
						y.domain([0, d3.max(data, function(d) {
							return d.total;
						})]);

						svg.append("g").attr("class", "x axis").attr("transform", "translate(0," + height + ")").style("fill", "#FFFFFF").call(xAxis);

						svg.append("g").attr("class", "y axis").style("fill", "#FFFFFF").call(yAxis).append("text").attr("transform", "rotate(-90)").attr("y", 6).attr("dy", ".71em").style("text-anchor", "end").text("Population");

						var state = svg.selectAll(".state").data(data).enter().append("g").attr("class", "g").attr("transform", function(d) {
							return "translate(" + x(d.State) + ",0)";
						});

						state.selectAll("rect").data(function(d) {
							return d.ages;
						}).enter().append("rect").attr("width", x.rangeBand()).attr("y", function(d) {
							return y(d.y1);
						}).attr("height", function(d) {
							return y(d.y0) - y(d.y1);
						}).style("fill", function(d) {
							return color(d.name);
						});

						var legend = svg.selectAll(".legend").data(color.domain().slice().reverse()).enter().append("g").attr("class", "legend").attr("transform", function(d, i) {
							return "translate(0," + i * 20 + ")";
						}).style("fill", "#FFFFFF");

						legend.append("rect").attr("x", width - 18).attr("width", 18).attr("height", 18).style("fill", color);

						legend.append("text").attr("x", width - 24).attr("y", 9).attr("dy", ".35em").style("text-anchor", "end").text(function(d) {
							return d;
						});

					});

				</script></td>
				<td style="font: 10px sans-serif;background-color:#302217">
				<div class="header">
					Volcano Details
				</div>
				<p style="color:white">*click on the red dots to add volcano data</p>
				<table id="dynamic-table" width="100%">
					<thead>
						<tr>
							<th width="50%">Name</th>
							<th width="30%">Type</th>
							<th>Year Erupted</th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
				</br>
				<button id="clear-table">
					Clear Table
				</button>
				<script>
					$("#clear-table").button();
					$("#clear-table").click(function() {
						$('#dynamic-table').dataTable().fnClearTable();
					});
				</script></td>
			</tr>
		</table>
	</body>
</html>
